version: "3.5"
services:
  isard-ipxe:
    volumes:
      - "/opt/isard/ipxe/images:/data/images:ro"
      - "/opt/isard/logs/ipxe.log:/data/logs/isard-ipxe.log"
      - "/opt/isard/certs/default:/data/certs:ro"
      - "/opt/isard/ipxe/conf/ipxe/config.yml:/data/config.yml"
    networks:
      - isard_network
    image: isard/ipxe:1.1
    restart: unless-stopped
    depends_on:
      - isard-app

  isard-dhcp:
    volumes:
      - "/opt/isard/ipxe/dhcp_leases:/var/lib/dhcp/dhcp_leases"
      - "${PWD}/dhcpd.conf:/etc/dhcpd/dhcpd.conf:ro"
    ports:
      - target: 67
        published: 67
        protocol: tcp
        mode: host
      - target: 67
        published: 67
        protocol: udp
        mode: host
    network_mode: host
    image: isard/dhcp:1.1
    restart: unless-stopped
    depends_on:
      - isard-tftp

  isard-tftp:
    volumes:
      - "/opt/isard/ipxe/images:/var/tftpboot:ro"
    ports:
      - target: 69
        published: 69
        protocol: tcp
        mode: host
      - target: 69
        published: 69
        protocol: udp
        mode: host
    image: isard/tftp:1.1
    restart: unless-stopped
    depends_on:
      - isard-ipxe


volumes:
  sshkeys:
  dhcp_leases:

networks:
  isard_network:
    external: false
    name: isard_network
